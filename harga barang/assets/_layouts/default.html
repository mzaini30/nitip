<!DOCTYPE html>
<html>
<head>
	<title>Harga Barang</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
	<style type="text/css">
		a,
		a:hover,
		a:visited,
		a:active,
		a:focus {
			text-decoration: none;
		}

		body {
			padding-bottom: 50px;
		}

		.sembunyi {
			display: none;
		}

		.menu-bawah table {
			margin-bottom: 0;
			border: 0 !important;
		}

		.menu-bawah td {
			border: 0 !important;
		}
	</style>
</head>
<body>
	<br>
	<div class="container">
		{{ content }}
		<div class="form-group">
			<p class="pull-right"><em><a href="https://wa.me/6281545143654">~ Zen</a></em></p>
		</div>
	</div>
	<div class="navbar navbar-fixed-bottom navbar-default menu-bawah">
		<div class="container">
			<table class="table table-bordered">
				<tbody>
					<tr>	
						<td>
							<input type="search" class="form-control cari-barang" placeholder="Cari apa?">
						</td>
						<td>
							<a href="menu.html" class="btn btn-default">Menu</a>		
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<script type="text/javascript" src="vendor/jquery/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="vendor/dexie/dexie.js"></script>
	<script>
		$.expr[':'].contains = $.expr.createPseudo(function(arg){
			return function(elem){
				return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0
			}
		})

		harga_barang = new Dexie('harga barang')
		harga_barang.version(1).stores({
			data: '++id, nama_barang, harga'
		})

		$('.tambah-data').on('submit', function(x){
			x.preventDefault()
			harga_barang.data.add({
				nama_barang: $('.nama-barang').val(),
				harga: $('.harga').val()
			}).then(function(){
				location.href = 'tambah.html?selesai-tambah'
			})
		})

		data_hasil = ''
		harga_barang.data.orderBy('nama_barang').each(function(x){
			data_hasil += '<tr class="hasil-pencarian-item"><td>' + x.nama_barang + '</td><td>Rp ' + Number(x.harga).toLocaleString("id") + '</td><td><a href="#!" data-hapus="' + x.id + '">Hapus</a></td></tr>'
		}).then(function(){
			$('.data-di-sini').html(data_hasil)
		}).then(function(){
			$("[data-hapus]").each(function(){
				$(this).click(function(){
					harga_barang.data.where({
						id: Number($(this).attr('data-hapus'))
					}).delete().then(function(){
						location.href = 'index.html?selesai-dihapus'
					})
				})
			})
		})

		if (location.search == '?selesai-tambah'){
			$('.berhasil-disimpan').removeClass('sembunyi')
		}
		if (location.search == '?selesai-dihapus'){
			$('.kalau-data-dihapus').removeClass('sembunyi')
		}

		$('.cari-barang').on('keyup', function(){
			if ($('.cari-barang').val() != ''){
				$('.hasil-pencarian-item').addClass('sembunyi')
				$('.hasil-pencarian-item').each(function(){
					if ($(this).is(":contains(" + $('.cari-barang').val() + ")")) {
						$(this).removeClass('sembunyi')
					}
				})
			} else {
				$('.hasil-pencarian-item').removeClass('sembunyi')
			}
		})
	</script>
</body>
</html>